<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <!-- PWA / app-like mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#FFC107" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="eatmi" />

  <title>eatmi.pl â€” ZamÃ³w online</title>
  <meta name="description" content="eatmi.pl â€” Boxy Å›niadaniowe, lunche, kanapki, zdrowe, sÅ‚odkie i napoje." />

  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <!-- Tailwind config MUST be before tailwindcdn script -->
  <script>
    tailwind = window.tailwind || {};
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              yellow: '#FFC107',
              dark: '#111827',
              light: '#F9FAFB'
            },
            kiosk: {
              bg: '#0B0F1A',
              card: '#0F1629',
              card2: '#111B34',
              green: '#22C55E',
              red: '#EF4444',
              blue: '#3B82F6',
              violet: '#8B5CF6',
              orange: '#F59E0B',
              gray: '#94A3B8'
            }
          },
          boxShadow: {
            soft: '0 10px 30px rgba(0,0,0,.08)',
            glass: '0 8px 25px rgba(0,0,0,.12)',
            kiosk: '0 14px 50px rgba(0,0,0,.35)'
          },
          borderRadius: { xl2: '1.25rem' }
        }
      }
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --tabbar-h: 72px;
      --cta-h: 56px;
      --safe-b: env(safe-area-inset-bottom, 0px);
      --safe-t: env(safe-area-inset-top, 0px);
    }

    html, body { height: 100%; }
    body { overscroll-behavior-y: none; }

    .liquid { background: rgba(255,255,255,.75); backdrop-filter: blur(12px); }
    .logo-glow { box-shadow: 0 12px 30px rgba(255,193,7,.18); }
    .toast-enter { animation: toastIn .18s ease-out; }
    .toast-bar { animation: toastBar 2.4s linear; transform-origin: left; }
    @keyframes toastIn { from { transform: translateY(8px); opacity: 0 } to { transform: translateY(0); opacity: 1 } }
    @keyframes toastBar { from { transform: scaleX(1) } to { transform: scaleX(0) } }

    .input-focus { outline: none; }
    .input-focus:focus { box-shadow: 0 0 0 3px rgba(255,193,7,.35); border-color: rgba(255,193,7,.75); }

    /* Wymuszenie Å¼Ã³Å‚tego dla 2 CTA w HERO */
    .btn-yellow{
      background:#FFC107 !important;
      color:#111827 !important;
      border-color: rgba(0,0,0,.08) !important;
    }
    .btn-yellow:hover{
      filter: brightness(.98);
      box-shadow: 0 0 0 3px rgba(255,193,7,.30);
    }

    /* Maintenance blur */
    .page-blur {
      filter: blur(10px);
      transform: translateZ(0);
    }

    /* App-like: treÅ›Ä‡ nie moÅ¼e chowaÄ‡ siÄ™ pod tabbarem (i CTA) */
    .app-content-pad {
      padding-bottom: calc(var(--tabbar-h) + var(--safe-b) + 18px);
    }
    .app-content-pad.has-cta {
      padding-bottom: calc(var(--tabbar-h) + var(--safe-b) + var(--cta-h) + 22px);
    }

    .no-overscroll { overscroll-behavior: none; }
  </style>

  <!-- React 18 + ReactDOM 18 -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel for inline JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-brand-light text-gray-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    /* =======================
       MENU
    ======================= */

    // âœ… DODANE: image dla kaÅ¼dej kategorii (pliki luzem w repo: /boxy.png itd.)
    const PRODUCT_CATEGORIES = [
      { id: 'boxy-sniadaniowe', name: 'Boxy Å›niadaniowe', icon: 'package-open', description: 'MaÅ‚e, Å›rednie i duÅ¼e zestawy. TakÅ¼e VEGE.', image: '/boxy.png' },
      { id: 'lunche', name: 'Lunche', icon: 'utensils-crossed', description: 'Lunch tygodnia, miesiÄ…ca i vege (12:00â€“16:00).', image: '/lunch.png' },
      { id: 'kanapki', name: 'Kanapki', icon: 'sandwich', description: 'Kanapki i buritto na maÅ›lanym pieczywie.', image: '/kanapki.png' },
      { id: 'zdrowe', name: 'Zdrowe', icon: 'leaf', description: 'Granola i saÅ‚atki w wersjach fit.', image: '/zdrowe.png' },
      { id: 'slodkie', name: 'SÅ‚odkie', icon: 'ice-cream', description: 'Desery, pancakes, tost francuski i smoothie.', image: '/slodkie.png' },
      { id: 'napoje', name: 'Napoje', icon: 'cup-soda', description: 'Kawy, herbaty, lemoniada i sok.', image: '/napoje.png' },
    ];

    const BREAKFAST_BOXES = [
      { id:'bs-small-1', name:'Box Å›niadaniowy maÅ‚y nr 1', price: 38, subtitle:'Kanapka z jajecznicÄ… i bekonem, majonez sriracha â€¢ Domowa granola z jogurtem greckim, owocami i miodem â€¢ Sok pomaraÅ„czowy 250 ml' },
      { id:'bs-small-2', name:'Box Å›niadaniowy maÅ‚y nr 2', price: 40, subtitle:'Buritto z jajecznicÄ… i chorizo â€¢ SaÅ‚atka koreaÅ„ska z kurczakiem w panko, warzywami i sezamem â€¢ Sok pomaraÅ„czowy 250 ml' },
      { id:'bs-small-3', name:'Box Å›niadaniowy maÅ‚y nr 3', price: 42, subtitle:'Kanapka z rostbefem, jajkiem poche, sosem musztardowo-chrzanowym i oliwÄ… truflowÄ… â€¢ SaÅ‚atka Cezar z kurczakiem, bekonem, saÅ‚atÄ… rzymskÄ… i grzankami â€¢ Sok pomaraÅ„czowy 250 ml' },
      { id:'bs-small-vege', name:'Box Å›niadaniowy maÅ‚y VEGE', price: 38, subtitle:'Kanapka z jajecznicÄ… i awokado, majonez sriracha â€¢ SaÅ‚atka z carpaccio z buraka z kozim serem i orzechami pekan, mix saÅ‚at, pomaraÅ„czowy dressing z oliwÄ… â€¢ Sok pomaraÅ„czowy 250 ml' },

      { id:'bs-med-1', name:'Box Å›niadaniowy Å›redni nr 1', price: 52, subtitle:'Kanapka z jajecznicÄ… i bekonem, majonez sriracha â€¢ Domowa granola z jogurtem greckim, owocami i miodem â€¢ Tost francuski z owocami i miodem â€¢ Sok pomaraÅ„czowy 250 ml' },
      { id:'bs-med-2', name:'Box Å›niadaniowy Å›redni nr 2', price: 54, subtitle:'Buritto z jajecznicÄ… i chorizo â€¢ SaÅ‚atka koreaÅ„ska z kurczakiem w panko, warzywami i sezamem â€¢ Pancakes (2 szt.) z NutellÄ… i owocami â€¢ Sok pomaraÅ„czowy 250 ml' },
      { id:'bs-med-3', name:'Box Å›niadaniowy Å›redni nr 3', price: 56, subtitle:'Kanapka z rostbefem, jajkiem poche, sosem musztardowo-chrzanowym i oliwÄ… truflowÄ… â€¢ SaÅ‚atka Cezar z kurczakiem, bekonem, saÅ‚atÄ… rzymskÄ… i grzankami â€¢ Deser czekoladowy z owocami i kruszonkÄ… â€¢ Sok pomaraÅ„czowy 250 ml' },
      { id:'bs-med-vege', name:'Box Å›niadaniowy Å›redni VEGE', price: 52, subtitle:'Kanapka z jajecznicÄ… i awokado, majonez sriracha â€¢ SaÅ‚atka z carpaccio z buraka z kozim serem i orzechami pekan, mix saÅ‚at, pomaraÅ„czowy dressing z oliwÄ… â€¢ Smoothie Mango Lassi z miodem â€¢ Sok pomaraÅ„czowy 250 ml' },

      { id:'bs-big-1', name:'Box Å›niadaniowy duÅ¼y nr 1', price: 80, subtitle:'Kanapka z jajecznicÄ… i bekonem, majonez sriracha â€¢ Club sandwich z kurczakiem i bekonem, majonez, saÅ‚ata, pomidor â€¢ Domowa granola z jogurtem greckim, owocami i miodem â€¢ SaÅ‚atka Cezar z kurczakiem, bekonem, saÅ‚atÄ… rzymskÄ… i grzankami â€¢ Tost francuski z owocami i miodem â€¢ Sok pomaraÅ„czowy 250 ml' },
      { id:'bs-big-2', name:'Box Å›niadaniowy duÅ¼y nr 2', price: 82, subtitle:'Buritto z jajecznicÄ… i chorizo â€¢ Kanapka z jajecznicÄ… i bekonem, majonez sriracha â€¢ SaÅ‚atka koreaÅ„ska z kurczakiem w panko, warzywa i sezamem â€¢ Domowa granola z jogurtem greckim, owocami i miodem â€¢ Pancakes (2 szt.) z NutellÄ… i owocami â€¢ Sok pomaraÅ„czowy 250 ml' },
      { id:'bs-big-3', name:'Box Å›niadaniowy duÅ¼y nr 3', price: 84, subtitle:'Kanapka z rostbefem, jajkiem poche, sosem musztardowo-chrzanowym i oliwÄ… truflowÄ… â€¢ Kanapka z jajecznicÄ… i bekonem, majonez sriracha â€¢ SaÅ‚atka Cezar z kurczakiem, bekonem, saÅ‚atÄ… rzymskÄ… i grzankami â€¢ Domowa granola z jogurtem greckim, owocami i miodem â€¢ Deser czekoladowy z owocami i kruszonkÄ… â€¢ Sok pomaraÅ„czowy 250 ml' },
      { id:'bs-big-vege', name:'Box Å›niadaniowy duÅ¼y VEGE', price: 80, subtitle:'Kanapka z jajecznicÄ… i awokado, majonez sriracha â€¢ Vege club sandwich z camembert i awokado, majonez, saÅ‚ata, pomidor â€¢ SaÅ‚atka z carpaccio z buraka z kozim serem i orzechami pekan, mix saÅ‚at, pomaraÅ„czowy dressing z oliwÄ… â€¢ Domowa granola z jogurtem greckim, owocami i miodem â€¢ Smoothie Mango Lassi z miodem â€¢ Sok pomaraÅ„czowy 250 ml' },
    ];

    const LUNCHES = [
      { id:'lunch-week', name:'Lunch tygodnia', price: 49, subtitle:'DostÄ™pny 12:00â€“16:00 â€¢ Zupa krem z pieczonych burakÃ³w 200 ml â€¢ Corn Flake Chicken: panierowana w pÅ‚atkach kukurydzianych pierÅ› z kurczaka z ziemniaczanym puree i coleslawem â€¢ Domowa lemoniada 250 ml' },
      { id:'lunch-month', name:'Lunch miesiÄ…ca', price: 59, subtitle:'DostÄ™pny 12:00â€“16:00 â€¢ Zupa krem z pieczonych burakÃ³w 200 ml â€¢ Kurczak Supreme: pieczona pierÅ› z kurczaka z ziemniaczanym puree, warzywami i sosem demi glace â€¢ Domowa lemoniada 250 ml' },
      { id:'lunch-vege', name:'Lunch VEGE', price: 49, subtitle:'DostÄ™pny 12:00â€“16:00 â€¢ Zupa krem z pieczonych burakÃ³w 200 ml â€¢ Tagliatelle z warzywami, oliwÄ… z oliwek i pastÄ… truflowÄ… â€¢ Domowa lemoniada 250 ml' },
    ];

    const SANDWICHES = [
      { id:'k-jajecznica-bekon', name:'MaÅ›lane pieczywo z jajecznicÄ…, bekonem i majonezem sriracha', price: 17 },
      { id:'k-club-kurczak', name:'Club sandwich z grillowanym kurczakiem, chrupiÄ…cy bekon, majonez, saÅ‚ata i pomidor', price: 17 },
      { id:'k-club-vege', name:'Vege club sandwich z camembert, palonym awokado, majonezem, saÅ‚atÄ… i pomidorem', price: 17 },
      { id:'k-jajecznica-avo', name:'MaÅ›lane pieczywo z jajecznicÄ…, awokado i majonezem sriracha', price: 17 },
      { id:'k-buritto-chorizo', name:'Buritto z jajecznicÄ… z mozzarellÄ…, chorizo i majonezem sriracha', price: 19 },
      { id:'k-rostbef', name:'MaÅ›lane pieczywo z rostbefem, jajkiem poche, rukolÄ…, sosem musztardowo-chrzanowym i oliwÄ… truflowÄ…', price: 21 },
    ];

    const HEALTHY = [
      { id:'z-granola', name:'Domowa granola z jogurtem greckim, owoce i miÃ³d', price: 19 },
      { id:'z-cezar', name:'SaÅ‚atka Cezar z kurczakiem, bekonem, saÅ‚atÄ… rzymskÄ…, parmezanem i grzankami', price: 19 },
      { id:'z-koreanska', name:'SaÅ‚atka koreaÅ„ska z kurczakiem w panko, warzywa i sezam, sÅ‚odki sos sojowy', price: 19 },
      { id:'z-burak', name:'SaÅ‚atka z carpaccio z buraka i serem kozim, karmelizowane orzechy pekan, mix saÅ‚at i pomaraÅ„czowy dressing', price: 19 },
    ];

    const SWEETS = [
      { id:'s-smoothie', name:'Smoothie Mango Lassi (mango, jogurt grecki, miÃ³d)', price: 19 },
      { id:'s-tost-fr', name:'Tost francuski z owocami i miodem', price: 19 },
      { id:'s-pancakes', name:'Pancakes (2 szt.) z NutellÄ… i owocami', price: 19 },
      { id:'s-deser-czeko', name:'Deser czekoladowy z owocami i kruszonkÄ…', price: 19 },
    ];

    const DRINKS = [
      { id:'n-lemoniada', name:'Domowa lemoniada 250 ml', price: 12 },
      { id:'n-sok-pom', name:'Sok pomaraÅ„czowy 250 ml', price: 12 },
      { id:'n-kawa-filt-cz', name:'Kawa filtrowana czarna 300 ml', price: 10 },
      { id:'n-kawa-filt-b', name:'Kawa filtrowana biaÅ‚a 300 ml', price: 10 },
      { id:'n-espresso-double', name:'Kawa czarna (podwÃ³jne espresso) 300 ml', price: 11 },
      { id:'n-flat-white', name:'Kawa Flat White (podwÃ³jne espresso) 300 ml', price: 11 },
      { id:'n-latte', name:'Latte (podwÃ³jne espresso) 300 ml', price: 12 },
      { id:'n-cappu', name:'Cappuccino (podwÃ³jne espresso) 300 ml', price: 11 },
      { id:'n-matcha', name:'Matcha 300 ml', price: 18 },
      { id:'n-herbata-cz', name:'Herbata czarna z cytrynÄ… 300 ml', price: 9 },
      { id:'n-zimowa', name:'Zimowa herbata z miodem, cytrusami, goÅºdzikami i sokiem malinowym 300 ml', price: 15 },
    ];

    const PRODUCTS = {
      'boxy-sniadaniowe': BREAKFAST_BOXES,
      'lunche': LUNCHES,
      'kanapki': SANDWICHES,
      'zdrowe': HEALTHY,
      'slodkie': SWEETS,
      'napoje': DRINKS,
    };

    /* =======================
       UTIL
    ======================= */

    const useLocalStorage = (key, initial) => {
      const [state, setState] = useState(() => {
        try { return JSON.parse(localStorage.getItem(key)) ?? initial } catch { return initial }
      });
      useEffect(() => { localStorage.setItem(key, JSON.stringify(state)) }, [key, state]);
      return [state, setState];
    };

    const currency = (n) =>
      new Intl.NumberFormat('pl-PL', { style:'currency', currency:'PLN' }).format(n);

    const haptics = () => {
      try { if (navigator.vibrate) navigator.vibrate(10); } catch {}
    };

    // MOBILE DETECTION: CTA ma byÄ‡ tylko na telefonie
    const useIsMobile = (breakpoint = 768) => {
      const [isMobile, setIsMobile] = useState(() => window.innerWidth < breakpoint);
      useEffect(() => {
        const onResize = () => setIsMobile(window.innerWidth < breakpoint);
        window.addEventListener("resize", onResize, { passive: true });
        return () => window.removeEventListener("resize", onResize);
      }, [breakpoint]);
      return isMobile;
    };

    /* =======================
       TOAST
    ======================= */

    const ToastContext = React.createContext();
    const useToast = () => React.useContext(ToastContext);

    const ToastProvider = ({children}) => {
      const [toast, setToast] = useState(null);
      const timeoutRef = React.useRef(null);

      const show = (message) => {
        setToast(message);
        if (timeoutRef.current) clearTimeout(timeoutRef.current);
        timeoutRef.current = setTimeout(() => setToast(null), 2500);
      };

      const close = () => {
        if (timeoutRef.current) clearTimeout(timeoutRef.current);
        setToast(null);
      };

      return (
        <ToastContext.Provider value={{ show }}>
          {children}
          {toast && (
            <div className="fixed bottom-[calc(var(--tabbar-h)+var(--safe-b)+18px)] left-1/2 -translate-x-1/2 z-[80] pointer-events-none">
              <div className="relative pointer-events-auto toast-enter bg-white/95 border border-emerald-200 shadow-glass rounded-2xl px-4 py-3 min-w-[260px] max-w-[90vw] flex items-start gap-3">
                <div className="w-9 h-9 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 text-lg">âœ“</div>
                <div className="flex-1">
                  <div className="text-[10px] font-semibold uppercase tracking-[0.12em] text-emerald-600">
                    Dodano do koszyka
                  </div>
                  <div className="text-sm text-gray-900 mt-0.5">{toast}</div>
                </div>
                <button
                  type="button"
                  onClick={close}
                  className="ml-2 text-gray-400 hover:text-gray-600 text-xl leading-none"
                  aria-label="Zamknij powiadomienie"
                >
                  Ã—
                </button>
                <div className="absolute left-4 right-4 -bottom-1.5 h-1 rounded-full overflow-hidden bg-emerald-50">
                  <div className="toast-bar h-full bg-emerald-400"></div>
                </div>
              </div>
            </div>
          )}
        </ToastContext.Provider>
      );
    };

    /* =======================
       CART
    ======================= */

    const CartContext = React.createContext();
    const useCart = () => React.useContext(CartContext);

    const CartProvider = ({children}) => {
      const [cart, setCart] = useLocalStorage('eatmi-cart', []);
      const toast = useToast();
      const show = toast?.show;

      const add = (entry) => {
        const newItem = {
          id: (crypto?.randomUUID ? crypto.randomUUID() : `${Date.now()}-${Math.random()}`),
          qty: 1,
          ...entry
        };
        setCart(prev => [...prev, newItem]);
        if (show) show(`Dodano: ${entry.name}`);
        haptics();
      };

      const remove  = (id) => setCart(prev => prev.filter(i => i.id !== id));
      const setQty  = (id, qty) => setCart(prev => prev.map(i => i.id === id ? {...i, qty: Math.max(1, qty|0)} : i));
      const incQty  = (id) => setCart(prev => prev.map(i => i.id === id ? {...i, qty: (i.qty||1)+1} : i));
      const decQty  = (id) => setCart(prev => prev.map(i => i.id === id ? {...i, qty: Math.max(1, (i.qty||1)-1)} : i));
      const clear   = () => setCart([]);

      const lineTotal = (i) => (i.price || 0) * (i.qty || 1);
      const total  = useMemo(() => cart.reduce((s,i)=> s + lineTotal(i), 0), [cart]);
      const count  = useMemo(() => cart.reduce((s,i)=> s + (i.qty||1), 0), [cart]);

      return (
        <CartContext.Provider value={{cart, add, remove, setQty, incQty, decQty, clear, lineTotal, total, count}}>
          {children}
        </CartContext.Provider>
      );
    };

    /* =======================
       HEADER / LOGO / CART BTN
    ======================= */

    const Logo = () => (
      <a href="#/" className="flex items-center gap-3 group">
        <div className="w-10 h-10 rounded-2xl bg-white flex items-center justify-center border border-gray-100 overflow-hidden shadow-soft logo-glow">
          <img
            src="https://i.imgur.com/f9TN0Gh.png"
            alt="eatmi.pl â€” logo"
            loading="lazy"
            className="w-9 h-9 object-contain transition-transform duration-500 group-hover:-rotate-6 group-hover:scale-110"
          />
        </div>
        <span className="font-extrabold tracking-tight">
          eatmi<span className="text-brand-yellow">.pl</span>
        </span>
      </a>
    );

    const CartButton = () => {
      const { total, count } = useCart();
      return (
        <a
          href="#/koszyk"
          className="relative inline-flex items-center justify-center gap-2 border border-gray-200 bg-white px-3 py-2 rounded-xl shadow-soft hover:shadow-md transition hover:ring-2 hover:ring-brand-yellow/50"
          aria-label="Koszyk"
        >
          <i data-lucide="shopping-cart" className="w-5 h-5"></i>
          <span className="hidden sm:inline text-sm font-semibold">{currency(total)}</span>
          <span className="absolute -top-2 -right-2 bg-brand-yellow text-gray-900 text-xs font-extrabold w-6 h-6 rounded-full grid place-items-center ring-2 ring-white">
            {count}
          </span>
        </a>
      );
    };

    const Header = ({ onOpenAuth }) => (
      <header className="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-gray-200">
        <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
          <Logo />

          <div className="hidden md:flex items-center gap-6 text-sm">
            <a href="#kategorie" className="hover:text-gray-900 text-gray-600">Menu</a>
            <a href="#/kategoria/boxy-sniadaniowe" className="hover:text-gray-900 text-gray-600">Boxy</a>
            <a href="#/kategoria/lunche" className="hover:text-gray-900 text-gray-600">Lunche</a>
            <a href="#/kategoria/kanapki" className="hover:text-gray-900 text-gray-600">Kanapki</a>
            <a href="#/kategoria/napoje" className="hover:text-gray-900 text-gray-600">Napoje</a>
          </div>

          <div className="flex items-center gap-3">
            <button
              type="button"
              onClick={onOpenAuth}
              className="hidden md:inline-flex items-center gap-2 border border-gray-200 bg-white px-4 py-2 rounded-xl shadow-soft hover:shadow-md transition text-sm font-semibold text-gray-800 hover:ring-2 hover:ring-brand-yellow/50">
              <i data-lucide="user" className="w-4 h-4"></i>
              <span>Konto</span>
            </button>

            <button
              type="button"
              onClick={onOpenAuth}
              className="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-xl border border-gray-200 bg-white shadow-soft hover:ring-2 hover:ring-brand-yellow/50"
              aria-label="Moje konto">
              <i data-lucide="user" className="w-5 h-5"></i>
            </button>

            {/* Koszyk zawsze w prawym gÃ³rnym rogu */}
            <CartButton />
          </div>
        </div>
      </header>
    );

    /* =======================
       HERO / UI
    ======================= */

    const Hero = () => (
      <section className="relative overflow-hidden">
        <div className="max-w-6xl mx-auto px-4 py-10 md:py-16">
          <div className="max-w-2xl">
            <div className="inline-flex items-center gap-2 mb-3 px-4 py-2 rounded-full bg-white/80 border border-gray-200 shadow-soft">
              <span className="text-xl">ðŸ‘‹</span>
              <span className="text-sm md:text-base font-semibold text-gray-900">
                CzeÅ›Ä‡, na co masz dziÅ› ochotÄ™?
              </span>
            </div>

            <h1 className="text-4xl md:text-5xl font-extrabold leading-tight">
              Wybierz kategoriÄ™ i{" "}
              <span className="text-brand-yellow">zamÃ³w online</span>
            </h1>
            <p className="mt-4 text-gray-600 max-w-prose">
              Boxy Å›niadaniowe, lunche, kanapki, zdrowe, sÅ‚odkie i napoje.
              Jak w kiosku â€” wybierasz kategoriÄ™, klikasz pozycje i finalizujesz zamÃ³wienie.
            </p>

            <div className="mt-6 flex flex-wrap gap-3">
              <a
                href="#kategorie"
                className="btn-yellow inline-flex items-center gap-2 font-extrabold px-6 py-3 rounded-xl2 shadow-soft hover:scale-[1.02] transition"
              >
                <i data-lucide="shopping-bag" className="w-5 h-5"></i>
                PrzeglÄ…daj menu
              </a>

              <a
                href="#/kategoria/boxy-sniadaniowe"
                className="btn-yellow inline-flex items-center gap-2 font-extrabold px-6 py-3 rounded-xl2 shadow-soft hover:scale-[1.02] transition"
              >
                <i data-lucide="package-open" className="w-5 h-5"></i>
                Zobacz boxy Å›niadaniowe
              </a>
            </div>
          </div>
        </div>
      </section>
    );

    const SectionTitle = ({eyebrow, title, subtitle}) => (
      <div className="text-center max-w-2xl mx-auto">
        {eyebrow && <div className="text-xs uppercase tracking-widest text-gray-500">{eyebrow}</div>}
        <h2 className="text-3xl md:text-4xl font-extrabold mt-1">{title}</h2>
        {subtitle && <p className="text-gray-600 mt-2">{subtitle}</p>}
      </div>
    );

    // âœ… ZMIANA: CategoryCard ma teraz cover image (category.image)
    const CategoryCard = ({ category }) => {
      const handleClick = () => { window.location.hash = `#/kategoria/${category.id}`; };
      return (
        <button
          type="button"
          onClick={handleClick}
          className="group relative bg-white border border-gray-200 rounded-2xl text-left shadow-soft hover:shadow-md hover:-translate-y-1 transition w-full overflow-hidden hover:ring-2 hover:ring-brand-yellow/60"
        >
          <div className="absolute inset-x-0 top-0 h-1.5 bg-gradient-to-r from-brand-yellow via-amber-300 to-orange-400 opacity-80 z-[2]"></div>

          {/* COVER IMAGE */}
          <div className="relative h-36 w-full overflow-hidden">
            <img
              src={category.image}
              alt={category.name}
              loading="lazy"
              className="h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.05]"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-black/35 to-transparent"></div>
          </div>

          <div className="p-5">
            <div className="flex items-center justify-between gap-3 mt-1">
              <div>
                <div className="inline-flex items-center gap-2 text-xs uppercase tracking-widest text-gray-500">
                  <span className="w-2.5 h-2.5 rounded-full bg-brand-yellow shadow-sm"></span>
                  Kategoria
                </div>
                <h3 className="mt-1 text-lg font-extrabold">{category.name}</h3>
              </div>

              <div className="w-10 h-10 rounded-xl bg-brand-yellow/20 grid place-items-center ring-1 ring-brand-yellow/30 group-hover:bg-brand-yellow/30 transition">
                <i data-lucide={category.icon} className="w-5 h-5 text-gray-900"></i>
              </div>
            </div>

            <p className="mt-3 text-sm text-gray-600">{category.description}</p>
            <div className="mt-4 inline-flex items-center gap-2 text-sm font-extrabold text-gray-900 group-hover:gap-3 transition">
              OtwÃ³rz kategoriÄ™ <i data-lucide="arrow-right" className="w-4 h-4"></i>
            </div>
          </div>
        </button>
      );
    };

    const splitSubtitle = (text='') =>
      text.split('â€¢').map(s => s.trim()).filter(Boolean);

    const getBadges = (categoryId, name) => {
      const badges = [];
      const upper = (name||'').toUpperCase();
      if (categoryId === 'boxy-sniadaniowe') badges.push({ label: 'BOX', color: 'bg-kiosk-blue/15 text-kiosk-blue border-kiosk-blue/30' });
      if (categoryId === 'lunche') badges.push({ label: 'LUNCH 12â€“16', color: 'bg-kiosk-orange/15 text-kiosk-orange border-kiosk-orange/30' });
      if (upper.includes('VEGE')) badges.push({ label: 'VEGE', color: 'bg-kiosk-green/15 text-kiosk-green border-kiosk-green/30' });
      return badges;
    };

    const ProductCard = ({ item, categoryId, onAdd }) => {
      const bullets = splitSubtitle(item.subtitle || '');
      const badges = getBadges(categoryId, item.name);

      return (
        <div className="relative bg-white border border-gray-200 rounded-3xl p-5 md:p-6 shadow-soft hover:shadow-kiosk transition group overflow-hidden hover:ring-2 hover:ring-brand-yellow/40">
          <div className="absolute inset-x-0 top-0 h-1.5 bg-gradient-to-r from-brand-yellow via-amber-300 to-orange-400 opacity-70"></div>

          <div className="mt-3 inline-flex items-center gap-2">
            <span className="text-[10px] font-extrabold tracking-widest uppercase px-2.5 py-1 rounded-full bg-brand-yellow text-gray-900 shadow-sm">
              HIT
            </span>
            <span className="text-[10px] font-extrabold tracking-widest uppercase px-2.5 py-1 rounded-full bg-brand-yellow/15 text-gray-900 border border-brand-yellow/30">
              Polecane
            </span>
          </div>

          {badges.length > 0 && (
            <div className="flex flex-wrap gap-2 mt-3">
              {badges.map((b, i) => (
                <span key={i}
                  className={`text-[10px] font-extrabold tracking-widest uppercase border px-2.5 py-1 rounded-full ${b.color}`}>
                  {b.label}
                </span>
              ))}
            </div>
          )}

          <h3 className="text-lg md:text-xl font-extrabold text-gray-900 leading-snug mt-3">
            {item.name}
          </h3>

          {bullets.length > 0 && (
            <ul className="mt-3 space-y-1.5 text-sm text-gray-700">
              {bullets.map((b, idx) => (
                <li key={idx} className="flex gap-2">
                  <span className="mt-[6px] w-1.5 h-1.5 rounded-full bg-gray-900/60 shrink-0"></span>
                  <span>{b}</span>
                </li>
              ))}
            </ul>
          )}

          <div className="mt-5 flex items-center justify-between gap-3">
            <div className="flex items-center gap-2">
              <div className="px-3 py-1.5 rounded-xl bg-gray-900 text-white font-extrabold text-base md:text-lg shadow">
                {currency(item.price)}
              </div>
              <div className="text-xs text-gray-500 font-semibold uppercase tracking-wider">
                / szt.
              </div>
            </div>

            <button
              type="button"
              onClick={() => onAdd(item)}
              className="inline-flex items-center justify-center gap-2 bg-brand-yellow text-gray-900 font-extrabold px-4 py-3 rounded-2xl shadow-soft hover:scale-[1.03] active:scale-[0.98] transition hover:ring-2 hover:ring-brand-yellow/40 min-h-[44px]"
            >
              <i data-lucide="plus" className="w-4 h-4"></i> Dodaj
            </button>
          </div>
        </div>
      );
    };

    const CategoryPage = ({ categoryId }) => {
      const { add } = useCart();
      const category = PRODUCT_CATEGORIES.find(c => c.id === categoryId);
      const items = PRODUCTS[categoryId] || [];

      if (!category) {
        return (
          <section className="py-10">
            <div className="max-w-6xl mx-auto px-4">
              <a href="#/" className="inline-flex items-center gap-2 text-sm text-gray-600">
                <i data-lucide="arrow-left" className="w-4 h-4"></i> WrÃ³Ä‡
              </a>
              <h2 className="text-2xl font-extrabold mt-3">Kategoria nie istnieje</h2>
              <p className="mt-2 text-gray-600">WrÃ³Ä‡ do menu i wybierz jednÄ… z dostÄ™pnych kategorii.</p>
            </div>
          </section>
        );
      }

      const handleAdd = (item) => add({
        type: 'product',
        productId: item.id,
        name: item.name,
        price: item.price
      });

      return (
        <section className="py-6 md:py-10">
          <div className="max-w-6xl mx-auto px-4">
            <a href="#/" className="inline-flex items-center gap-2 text-sm text-gray-600">
              <i data-lucide="arrow-left" className="w-4 h-4"></i> WrÃ³Ä‡ do menu
            </a>

            <div className="mt-4 flex items-center gap-3">
              <div className="w-11 h-11 rounded-2xl bg-brand-yellow/20 grid place-items-center ring-1 ring-brand-yellow/30">
                <i data-lucide={category.icon} className="w-6 h-6 text-gray-900"></i>
              </div>
              <div>
                <h2 className="text-2xl md:text-3xl font-extrabold">{category.name}</h2>
                <p className="text-sm text-gray-600 mt-1">{category.description}</p>
              </div>
            </div>

            <div className="mt-6 grid gap-5 sm:grid-cols-2 xl:grid-cols-3 md:gap-6">
              {items.map(item => (
                <ProductCard
                  key={item.id}
                  item={item}
                  categoryId={categoryId}
                  onAdd={handleAdd}
                />
              ))}
            </div>
          </div>
        </section>
      );
    };

    /* =======================
       KOSZYK / CHECKOUT
    ======================= */

    const EXTRA_ITEMS = [
      { id:'extra-granola', name:'Domowa granola', price: 19 },
      { id:'extra-lemoniada',name:'Domowa lemoniada', price: 12 },
      { id:'extra-deser', name:'Deser czekoladowy', price: 19 },
    ];

    const Koszyk = () => {
      const { cart, remove, clear, total, incQty, decQty, setQty, lineTotal, add } = useCart();
      const goToCheckout = () => window.location.hash = '#/zamowienie';

      return (
        <section className="py-8 md:py-10">
          <div className="max-w-6xl mx-auto px-4">
            <a href="#/" className="inline-flex items-center gap-2 text-sm text-gray-600">
              <i data-lucide="arrow-left" className="w-4 h-4"></i> WrÃ³Ä‡
            </a>
            <h2 className="text-2xl font-extrabold mt-3">Koszyk</h2>

            {cart.length === 0 ? (
              <div className="mt-4 bg-white border border-gray-200 rounded-2xl p-5">
                <p className="text-gray-700 font-semibold">TwÃ³j koszyk jest pusty.</p>
                <a href="#kategorie" className="inline-flex mt-3 items-center gap-2 bg-brand-yellow text-gray-900 font-extrabold rounded-xl px-4 py-3 hover:ring-2 hover:ring-brand-yellow/40 min-h-[44px]">
                  <i data-lucide="shopping-bag" className="w-5 h-5"></i>
                  Wybierz menu
                </a>
              </div>
            ) : (
              <>
                <div className="mt-6 grid md:grid-cols-3 gap-6 items-start">
                  <div className="md:col-span-2 space-y-4">
                    {cart.map(item => (
                      <div key={item.id}
                        className="bg-white border border-gray-200 rounded-2xl p-4 flex flex-col md:flex-row gap-4 md:items-center justify-between w-full hover:ring-2 hover:ring-brand-yellow/30 transition">
                        <div className="min-w-0 flex-1">
                          <div className="font-bold break-words">{item.name}</div>
                          <div className="text-xs text-gray-500 mt-1">
                            ID produktu: <span className="font-mono">{item.productId || 'brak'}</span>
                          </div>
                        </div>

                        <div className="flex flex-col sm:flex-row md:flex-row gap-3 md:gap-4 items-stretch md:items-center w-full md:w-auto justify-between md:justify-end">
                          <div className="flex items-center gap-2 self-start">
                            <button onClick={()=> decQty(item.id)} className="w-10 h-10 rounded-xl border border-gray-200 grid place-items-center hover:ring-2 hover:ring-brand-yellow/40">âˆ’</button>
                            <input
                              value={item.qty||1}
                              onChange={(e)=> setQty(item.id, parseInt(e.target.value||'1',10))}
                              className="input-focus w-16 text-center border border-gray-200 rounded-xl py-2"
                              inputMode="numeric"
                              pattern="[0-9]*"
                            />
                            <button onClick={()=> incQty(item.id)} className="w-10 h-10 rounded-xl border border-gray-200 grid place-items-center hover:ring-2 hover:ring-brand-yellow/40">+</button>
                          </div>

                          <div className="text-right self-center">
                            <div className="font-extrabold whitespace-nowrap">{currency(lineTotal(item))}</div>
                            <div className="text-xs text-gray-500 whitespace-nowrap">({currency(item.price)} / szt.)</div>
                          </div>

                          <button onClick={()=> remove(item.id)} className="text-red-600 hover:underline self-center text-sm">UsuÅ„</button>
                        </div>
                      </div>
                    ))}
                  </div>

                  <aside className="bg-white border border-gray-200 rounded-2xl p-5 sticky top-[84px]">
                    <div className="flex items-center justify-between">
                      <span className="font-semibold">Suma</span>
                      <span className="font-extrabold">{currency(total)}</span>
                    </div>
                    <div className="mt-4 grid gap-2">
                      <button
                        onClick={goToCheckout}
                        className="w-full bg-brand-yellow text-gray-900 font-extrabold rounded-xl px-4 py-3 hover:ring-2 hover:ring-brand-yellow/40 min-h-[44px]"
                      >
                        PrzejdÅº do zamÃ³wienia
                      </button>
                      <button onClick={clear} className="w-full bg-gray-100 text-gray-700 rounded-xl px-4 py-3 hover:ring-2 hover:ring-brand-yellow/20 min-h-[44px]">
                        WyczyÅ›Ä‡ koszyk
                      </button>
                    </div>
                  </aside>
                </div>

                <div className="mt-10 border-t border-gray-200 pt-6">
                  <h3 className="text-lg font-bold flex items-center gap-2">
                    <span>MoÅ¼e dorzucisz coÅ› jeszcze?</span>
                    <span className="text-xs px-2 py-0.5 rounded-full bg-brand-yellow text-gray-900 font-extrabold">1 klik i dodane</span>
                  </h3>
                  <p className="text-sm text-gray-600 mt-1">
                    SÅ‚odki dodatek lub napÃ³j czÄ™sto robi rÃ³Å¼nicÄ™ â€” szczegÃ³lnie przy wiÄ™kszych zamÃ³wieniach.
                  </p>

                  <div className="mt-4 flex flex-wrap gap-3">
                    {EXTRA_ITEMS.map(extra => (
                      <button key={extra.id}
                        onClick={() => add({
                          type:'extra',
                          productId: extra.id,
                          name: extra.name,
                          price: extra.price
                        })}
                        className="flex items-center gap-2 px-4 py-3 rounded-full bg-white border border-gray-200 shadow-soft text-sm hover:shadow-md hover:-translate-y-0.5 transition hover:ring-2 hover:ring-brand-yellow/30 min-h-[44px]">
                        <span className="text-base font-extrabold text-brand-yellow">+</span>
                        <span>{extra.name}</span>
                        <span className="font-extrabold text-gray-900">{currency(extra.price)}</span>
                      </button>
                    ))}
                  </div>
                </div>
              </>
            )}
          </div>
        </section>
      );
    };

    const Zamowienie = () => {
      const { cart, total, lineTotal } = useCart();
      const [form, setForm] = useState({
        imieNazwisko:'', telefon:'', email:'', miasto:'', kod:'', ulica:'', nrBud:'', pietro:'', lokal:'', uwagi:'', faktura:false, nip:'', firma:''
      });

      const handle = (k,v)=> setForm(s=> ({...s,[k]:v}));

      const submit = async () => {
        if(!form.imieNazwisko || !form.telefon || !form.miasto || !form.ulica) {
          alert('UzupeÅ‚nij wymagane pola');
          return;
        }
        if (!cart.length) {
          alert('Koszyk jest pusty.');
          return;
        }

        const missing = cart.find(i => !i.productId);
        if (missing) {
          alert("W koszyku jest pozycja bez productId. Dodaj produkt ponownie.");
          console.log("Missing productId item:", missing);
          return;
        }

        try {
          const payload = {
            customer: form,
            cart: cart.map(i => ({ productId: i.productId, qty: i.qty || 1 }))
          };

          const r = await fetch("/api/payu/order", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const data = await r.json().catch(() => ({}));

          if (!r.ok) {
            alert("BÅ‚Ä…d serwera: " + (data.error || r.status));
            console.log("PAYU ERROR DETAILS:", data);
            return;
          }

          if (!data.redirectUri) {
            alert("Brak redirectUri. Zobacz konsolÄ™ (PAYU RESPONSE).");
            console.log("PAYU RESPONSE:", data);
            return;
          }

          window.location.href = data.redirectUri;
        } catch (e) {
          alert("BÅ‚Ä…d poÅ‚Ä…czenia z serwerem.");
          console.log(e);
        }
      };

      return (
        <section className="py-8 md:py-10">
          <div className="max-w-6xl mx-auto px-4">
            <a href="#/koszyk" className="inline-flex items-center gap-2 text-sm text-gray-600">
              <i data-lucide="arrow-left" className="w-4 h-4"></i> WrÃ³Ä‡ do koszyka
            </a>
            <h2 className="text-2xl font-extrabold mt-3">ZamÃ³wienie</h2>

            <div className="mt-6 grid lg:grid-cols-3 gap-6 items-start">
              <div className="lg:col-span-2 bg-white border border-gray-200 rounded-2xl p-5">
                <div className="grid md:grid-cols-2 gap-4">
                  <div>
                    <label className="text-xs uppercase tracking-wider text-gray-500">ImiÄ™ i nazwisko *</label>
                    <input value={form.imieNazwisko} onChange={e=>handle('imieNazwisko', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                  </div>
                  <div>
                    <label className="text-xs uppercase tracking-wider text-gray-500">Nr telefonu *</label>
                    <input value={form.telefon} onChange={e=>handle('telefon', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                  </div>
                  <div>
                    <label className="text-xs uppercase tracking-wider text-gray-500">Adres email</label>
                    <input value={form.email} onChange={e=>handle('email', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                  </div>
                  <div>
                    <label className="text-xs uppercase tracking-wider text-gray-500">Miasto *</label>
                    <input value={form.miasto} onChange={e=>handle('miasto', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                  </div>
                  <div>
                    <label className="text-xs uppercase tracking-wider text-gray-500">Kod pocztowy</label>
                    <input value={form.kod} onChange={e=>handle('kod', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                  </div>
                  <div>
                    <label className="text-xs uppercase tracking-wider text-gray-500">Ulica *</label>
                    <input value={form.ulica} onChange={e=>handle('ulica', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                  </div>
                  <div>
                    <label className="text-xs uppercase tracking-wider text-gray-500">Nr budynku</label>
                    <input value={form.nrBud} onChange={e=>handle('nrBud', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                  </div>
                  <div>
                    <label className="text-xs uppercase tracking-wider text-gray-500">PiÄ™tro</label>
                    <input value={form.pietro} onChange={e=>handle('pietro', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                  </div>
                  <div>
                    <label className="text-xs uppercase tracking-wider text-gray-500">Nr lokalu</label>
                    <input value={form.lokal} onChange={e=>handle('lokal', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                  </div>
                  <div className="md:col-span-2">
                    <label className="text-xs uppercase tracking-wider text-gray-500">Uwagi do zamÃ³wienia</label>
                    <textarea value={form.uwagi} onChange={e=>handle('uwagi', e.target.value)}
                      className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 min-h-[120px] bg-white"></textarea>
                  </div>
                </div>

                <div className="mt-4">
                  <label className="flex items-center gap-2 text-sm">
                    <input type="checkbox" checked={form.faktura} onChange={e=>handle('faktura', e.target.checked)} />
                    ChcÄ™ dane do faktury
                  </label>
                  {form.faktura && (
                    <div className="grid md:grid-cols-2 gap-4 mt-3">
                      <div>
                        <label className="text-xs uppercase tracking-wider text-gray-500">NIP</label>
                        <input value={form.nip} onChange={e=>handle('nip', e.target.value)}
                          className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                      </div>
                      <div>
                        <label className="text-xs uppercase tracking-wider text-gray-500">Nazwa firmy</label>
                        <input value={form.firma} onChange={e=>handle('firma', e.target.value)}
                          className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                      </div>
                    </div>
                  )}
                </div>
              </div>

              <aside className="bg-white border border-gray-200 rounded-2xl p-5 sticky top-[84px]">
                <div className="font-semibold">Podsumowanie</div>
                <div className="mt-3 space-y-3 max-h-64 overflow-auto pr-2">
                  {cart.map(i => (
                    <div key={i.id} className="text-sm">
                      <div className="flex items-center justify-between gap-3">
                        <span className="font-medium">{i.name} Ã— {i.qty||1}</span>
                        <span className="font-bold">{currency(lineTotal(i))}</span>
                      </div>
                      <div className="text-[11px] text-gray-500 mt-0.5 font-mono">
                        {i.productId}
                      </div>
                    </div>
                  ))}
                </div>
                <div className="flex items-center justify-between mt-4 text-lg">
                  <span className="font-bold">Do zapÅ‚aty</span>
                  <span className="font-extrabold">{currency(total)}</span>
                </div>
                <button onClick={submit}
                  className="w-full mt-4 bg-brand-yellow text-gray-900 font-extrabold rounded-xl px-4 py-3 hover:ring-2 hover:ring-brand-yellow/40 min-h-[44px]">
                  PÅ‚atnoÅ›Ä‡ online (PayU)
                </button>
                <div className="text-xs text-gray-500 mt-3">
                  JeÅ›li coÅ› nie dziaÅ‚a) â†’ log: <span className="font-mono">PAYU ERROR DETAILS</span>.
                </div>
              </aside>
            </div>
          </div>
        </section>
      );
    };

    /* =======================
       AUTH MODAL
    ======================= */

    const AuthModal = ({ open, onClose }) => {
      const [mode, setMode] = useState('login');
      const [form, setForm] = useState({ email: '', password: '', confirm: '' });
      if (!open) return null;

      const handleChange = (field, value) => setForm(prev => ({ ...prev, [field]: value }));

      const handleSubmit = (e) => {
        e.preventDefault();
        if (mode === 'register' && form.password !== form.confirm) {
          alert('HasÅ‚a nie sÄ… takie same.');
          return;
        }
        alert(`(${mode === 'login' ? 'Logowanie' : 'Rejestracja'}) to na razie makieta UI :)`);
        onClose();
      };

      return (
        <div className="fixed inset-0 z-[90] bg-black/60 flex items-center justify-center px-4" onClick={onClose} role="dialog" aria-modal="true">
          <div className="relative w-full max-w-md bg-white rounded-2xl shadow-glass border border-gray-200 p-6" onClick={(e) => e.stopPropagation()}>
            <button type="button" onClick={onClose} className="absolute top-3 right-3 p-2 rounded-full bg-white border border-gray-200 shadow-soft hover:bg-gray-50 hover:ring-2 hover:ring-brand-yellow/40" aria-label="Zamknij okno logowania">
              <i data-lucide="x" className="w-4 h-4"></i>
            </button>

            <div className="mb-4">
              <div className="text-xs uppercase tracking-[0.16em] text-gray-500 font-semibold">
                {mode === 'login' ? 'Logowanie' : 'Rejestracja'}
              </div>
              <h3 className="text-xl font-extrabold mt-1">
                {mode === 'login' ? 'Zaloguj siÄ™ do eatmi' : 'ZaÅ‚Ã³Å¼ konto w eatmi'}
              </h3>
              <p className="text-xs text-gray-500 mt-1">
                {mode === 'login'
                  ? 'Zamawiaj szybciej i Å›ledÅº historiÄ™ zamÃ³wieÅ„ (makieta).'
                  : 'UtwÃ³rz konto, aby w przyszÅ‚oÅ›ci zapisywaÄ‡ dane dostawy (makieta).'}
              </p>
            </div>

            <form onSubmit={handleSubmit} className="space-y-3">
              <div>
                <label className="text-xs uppercase tracking-wider text-gray-500">Adres e-mail</label>
                <input type="email" required value={form.email}
                  onChange={(e) => handleChange('email', e.target.value)}
                  placeholder="np. jan.kowalski@example.com"
                  className="input-focus mt-1 w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
              </div>

              <div>
                <label className="text-xs uppercase tracking-wider text-gray-500">HasÅ‚o</label>
                <input type="password" required value={form.password}
                  onChange={(e) => handleChange('password', e.target.value)}
                  placeholder="Wpisz hasÅ‚o"
                  className="input-focus mt-1 w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
              </div>

              {mode === 'register' && (
                <div>
                  <label className="text-xs uppercase tracking-wider text-gray-500">PowtÃ³rz hasÅ‚o</label>
                  <input type="password" required value={form.confirm}
                    onChange={(e) => handleChange('confirm', e.target.value)}
                    placeholder="PowtÃ³rz hasÅ‚o"
                    className="input-focus mt-1 w-full border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"/>
                </div>
              )}

              <button type="submit" className="w-full mt-1 bg-gray-900 text-white font-semibold rounded-xl px-4 py-3 text-sm hover:bg-black hover:ring-2 hover:ring-brand-yellow/30 min-h-[44px]">
                {mode === 'login' ? 'Zaloguj siÄ™' : 'Zarejestruj siÄ™'}
              </button>
            </form>

            <div className="mt-4 text-xs text-gray-600 text-center">
              {mode === 'login' ? (
                <>Nie masz konta?{' '}
                  <button type="button" onClick={() => { setMode('register'); setForm({ email:'', password:'', confirm:'' }) }}
                    className="font-semibold text-gray-900 underline underline-offset-2">
                    Zarejestruj siÄ™
                  </button>
                </>
              ) : (
                <>Masz konto?{' '}
                  <button type="button" onClick={() => { setMode('login'); setForm({ email:'', password:'', confirm:'' }) }}
                    className="font-semibold text-gray-900 underline underline-offset-2">
                    Zaloguj siÄ™
                  </button>
                </>
              )}
            </div>
          </div>
        </div>
      );
    };

    /* =======================
       HOME
    ======================= */

    const Home = () => (
      <>
        <Hero />

        <section id="kategorie" className="py-12 md:py-20 bg-gradient-to-b from-white to-brand-light">
          <div className="max-w-6xl mx-auto px-4">
            <SectionTitle eyebrow="Menu" title="Wybierz kategoriÄ™" subtitle="Najpierw wybierz kategoriÄ™, potem dodawaj pozycje do koszyka â€” w kilka klikniÄ™Ä‡!" />
            <div className="mt-8 grid gap-5 md:grid-cols-3 md:gap-6">
              {PRODUCT_CATEGORIES.map(cat => <CategoryCard key={cat.id} category={cat} />)}
            </div>
          </div>
        </section>

        <section id="kontakt" className="py-12 bg-white">
          <div className="max-w-6xl mx-auto px-4">
            <SectionTitle title="Kontakt" subtitle="Masz pytania? Napisz do nas." />
            <form className="max-w-xl mx-auto mt-8 bg-white border border-gray-200 rounded-2xl p-6 shadow-soft hover:ring-2 hover:ring-brand-yellow/20 transition">
              <div className="grid md:grid-cols-2 gap-4">
                <input className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 min-h-[44px]" placeholder="ImiÄ™" />
                <input className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 min-h-[44px]" placeholder="Email" />
              </div>
              <textarea className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 mt-4" rows="4" placeholder="WiadomoÅ›Ä‡"></textarea>
              <button type="button" className="mt-4 bg-brand-yellow text-gray-900 rounded-xl px-5 py-3 font-extrabold hover:ring-2 hover:ring-brand-yellow/40 min-h-[44px]">
                WyÅ›lij
              </button>
            </form>
          </div>
        </section>
      </>
    );

    /* =======================
       APP NAV: TAB BAR + CATEGORY SHEET + FLOATING CTA (MOBILE ONLY)
    ======================= */

    const lockBodyScroll = (lock) => {
      const body = document.body;
      if (!body) return;
      if (lock) {
        body.dataset._scrollY = String(window.scrollY || 0);
        body.style.position = "fixed";
        body.style.top = `-${window.scrollY || 0}px`;
        body.style.left = "0";
        body.style.right = "0";
        body.style.width = "100%";
      } else {
        const y = parseInt(body.dataset._scrollY || "0", 10) || 0;
        body.style.position = "";
        body.style.top = "";
        body.style.left = "";
        body.style.right = "";
        body.style.width = "";
        delete body.dataset._scrollY;
        window.scrollTo(0, y);
      }
    };

    const CategorySheet = ({ open, onClose }) => {
      useEffect(() => {
        if (open) lockBodyScroll(true);
        return () => lockBodyScroll(false);
      }, [open]);

      useEffect(() => {
        const onKey = (e) => {
          if (!open) return;
          if (e.key === "Escape") onClose?.();
        };
        window.addEventListener("keydown", onKey);
        return () => window.removeEventListener("keydown", onKey);
      }, [open, onClose]);

      useEffect(() => { window.lucide?.createIcons?.(); }, [open]);

      if (!open) return null;

      const go = (id) => {
        window.location.hash = `#/kategoria/${id}`;
        onClose?.();
      };

      return (
        <div className="fixed inset-0 z-[100]">
          <div className="absolute inset-0 bg-black/50" onClick={onClose} aria-hidden="true"></div>

          <div className="absolute inset-x-0 bottom-0">
            <div
              className="mx-auto w-full max-w-2xl bg-white rounded-t-3xl border border-gray-200 shadow-glass p-4"
              style={{ paddingBottom: "calc(var(--safe-b) + 12px)" }}
              role="dialog"
              aria-modal="true"
              onClick={(e)=>e.stopPropagation()}
            >
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-xs uppercase tracking-[0.16em] text-gray-500 font-semibold">ZamÃ³w</div>
                  <div className="text-xl font-extrabold mt-0.5">Wybierz kategoriÄ™</div>
                </div>
                <button
                  type="button"
                  onClick={onClose}
                  className="w-11 h-11 rounded-2xl border border-gray-200 bg-white shadow-soft grid place-items-center hover:ring-2 hover:ring-brand-yellow/40"
                  aria-label="Zamknij"
                >
                  <i data-lucide="x" className="w-5 h-5"></i>
                </button>
              </div>

              <div className="mt-4 grid gap-3">
                {PRODUCT_CATEGORIES.map((c) => (
                  <button
                    key={c.id}
                    type="button"
                    onClick={() => go(c.id)}
                    className="w-full flex items-center justify-between gap-3 rounded-2xl border border-gray-200 bg-white px-4 py-4 shadow-soft hover:ring-2 hover:ring-brand-yellow/40"
                  >
                    <div className="flex items-center gap-3 text-left min-w-0">
                      {/* mini thumb */}
                      <div className="w-11 h-11 rounded-2xl overflow-hidden border border-gray-200 shrink-0">
                        <img src={c.image} alt={c.name} className="w-full h-full object-cover" loading="lazy" />
                      </div>

                      <div className="min-w-0">
                        <div className="font-extrabold">{c.name}</div>
                        <div className="text-xs text-gray-600 mt-0.5 line-clamp-2">{c.description}</div>
                      </div>
                    </div>
                    <i data-lucide="chevron-right" className="w-5 h-5 text-gray-400"></i>
                  </button>
                ))}
              </div>

              <div className="mt-4 text-xs text-gray-500">
                Tip: moÅ¼esz teÅ¼ przewijaÄ‡ stronÄ™ i klikaÄ‡ w kategorie na Home.
              </div>
            </div>
          </div>
        </div>
      );
    };

    const TabButton = ({ active, label, icon, onClick, badge }) => (
      <button
        type="button"
        onClick={onClick}
        className={`flex flex-col items-center justify-center gap-1 py-2 px-3 rounded-2xl transition min-h-[52px] ${
          active ? "bg-brand-yellow/20 ring-1 ring-brand-yellow/30" : "hover:bg-gray-100"
        }`}
        aria-label={label}
      >
        <span className="relative">
          <i data-lucide={icon} className="w-6 h-6"></i>
          {typeof badge === "number" && badge > 0 && (
            <span className="absolute -top-2 -right-2 bg-brand-yellow text-gray-900 text-[10px] font-extrabold w-5 h-5 rounded-full grid place-items-center ring-2 ring-white">
              {badge > 99 ? "99+" : badge}
            </span>
          )}
        </span>
        <span className={`text-[11px] font-extrabold ${active ? "text-gray-900" : "text-gray-600"}`}>
          {label}
        </span>
      </button>
    );

    const BottomTabBar = ({ route, onOpenOrder, onOpenAuth }) => {
      const { count } = useCart();

      useEffect(() => { window.lucide?.createIcons?.(); }, [route, count]);

      const isHome = !route || route === "#/" || route === "#";
      const isCart = route === "#/koszyk";
      const isOrder = route?.startsWith("#/kategoria/") || route === "#/zamowienie";

      return (
        <div className="fixed inset-x-0 bottom-0 z-[70]">
          <div
            className="mx-auto w-full max-w-2xl px-3"
            style={{ paddingBottom: "calc(var(--safe-b) + 10px)" }}
          >
            <div className="liquid border border-white/60 shadow-glass rounded-3xl px-2 py-2">
              <div className="grid grid-cols-4 gap-2">
                <TabButton
                  active={isHome}
                  label="Start"
                  icon="home"
                  onClick={() => { window.location.hash = "#/"; }}
                />
                <TabButton
                  active={isOrder}
                  label="ZamÃ³w"
                  icon="shopping-bag"
                  onClick={onOpenOrder}
                />
                <TabButton
                  active={isCart}
                  label="Koszyk"
                  icon="shopping-cart"
                  badge={count}
                  onClick={() => { window.location.hash = "#/koszyk"; }}
                />
                <TabButton
                  active={false}
                  label="Konto"
                  icon="user"
                  onClick={onOpenAuth}
                />
              </div>
            </div>
          </div>
        </div>
      );
    };

    const FloatingCheckoutCTA = ({ visible }) => {
      const { total, count } = useCart();
      useEffect(() => { window.lucide?.createIcons?.(); }, [visible, total, count]);
      if (!visible) return null;

      return (
        <div
          className="fixed inset-x-0 z-[75] md:hidden"
          style={{ bottom: "calc(var(--tabbar-h) + var(--safe-b) + 10px)" }}
        >
          <div className="mx-auto w-full max-w-2xl px-3">
            <button
              type="button"
              onClick={() => { window.location.hash = "#/koszyk"; }}
              className="w-full bg-gray-900 text-white font-extrabold rounded-2xl px-4 py-4 shadow-glass hover:ring-2 hover:ring-brand-yellow/40 flex items-center justify-between gap-3 min-h-[56px]"
            >
              <span className="flex items-center gap-2">
                <i data-lucide="receipt" className="w-5 h-5"></i>
                Zobacz swoje zamÃ³wienie
              </span>
              <span className="text-sm font-extrabold">
                {count} â€¢ {currency(total)}
              </span>
            </button>
          </div>
        </div>
      );
    };

    /* =======================
       ROUTER
    ======================= */

    const Router = () => {
      const [route, setRoute] = useState(window.location.hash || '#/');

      useEffect(()=>{
        const onHash = () => setRoute(window.location.hash || '#/');
        window.addEventListener('hashchange', onHash);
        return ()=> window.removeEventListener('hashchange', onHash);
      },[]);

      useEffect(()=> { window.lucide?.createIcons?.(); }, [route]);

      if (route.startsWith('#/kategoria/')) {
        const id = route.split('/')[2];
        return <CategoryPage categoryId={id} />;
      }
      if(route === '#/koszyk') return <Koszyk />;
      if(route === '#/zamowienie') return <Zamowienie />;
      return <Home />;
    };

    /* =======================
       MAINTENANCE OVERLAY + DEV UNLOCK
    ======================= */

    const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1446213305067769970/ZkfUbnPddZ4PmXBeidPfhoRDyhKwZtlAnRksp_okBNb-dufbR2ueBLW7cqrb9MaSUpLv";
    const DEV_CODE = "0051";

    const DeveloperUnlock = ({ onUnlock }) => {
      const [open, setOpen] = useState(false);
      const [code, setCode] = useState("");
      const [error, setError] = useState("");

      useEffect(() => {
        const onKey = (e) => {
          if (!open) return;
          if (e.key === "Escape") {
            setOpen(false);
            setCode("");
            setError("");
          }
        };
        window.addEventListener("keydown", onKey);
        return () => window.removeEventListener("keydown", onKey);
      }, [open]);

      const submit = () => {
        if ((code || "").trim() === DEV_CODE) {
          setOpen(false);
          setCode("");
          setError("");
          onUnlock?.();
          return;
        }
        setError("NieprawidÅ‚owy kod.");
      };

      return (
        <>
          <button
            type="button"
            onClick={() => { setOpen(true); setError(""); setCode(""); }}
            className="fixed bottom-[calc(var(--tabbar-h)+var(--safe-b)+14px)] right-4 z-[120] text-[11px] font-semibold px-3 py-2 rounded-xl bg-white/90 border border-gray-200 shadow-glass hover:ring-2 hover:ring-brand-yellow/40"
            title="Developer"
          >
            developer
          </button>

          {open && (
            <div
              className="fixed inset-0 z-[130] bg-black/60 flex items-center justify-center px-4"
              onClick={() => setOpen(false)}
              role="dialog"
              aria-modal="true"
            >
              <div
                className="w-full max-w-sm bg-white rounded-2xl border border-gray-200 shadow-glass p-5"
                onClick={(e) => e.stopPropagation()}
              >
                <div className="text-xs uppercase tracking-[0.16em] text-gray-500 font-semibold">Developer</div>
                <div className="text-xl font-extrabold mt-1">Wpisz kod</div>
                <p className="text-sm text-gray-600 mt-2">Po poprawnym kodzie strona odblokuje podglÄ…d.</p>

                <div className="mt-4 space-y-2">
                  <input
                    className="input-focus w-full border border-gray-200 rounded-xl px-4 py-3 bg-white font-mono min-h-[44px]"
                    placeholder="np. 5555"
                    value={code}
                    onChange={(e) => setCode(e.target.value)}
                    inputMode="numeric"
                    autoFocus
                  />
                  {error && <div className="text-sm text-red-600 font-semibold">{error}</div>}
                </div>

                <div className="mt-4 grid grid-cols-2 gap-2">
                  <button
                    type="button"
                    onClick={() => setOpen(false)}
                    className="w-full bg-gray-100 text-gray-800 font-semibold rounded-xl px-4 py-3 hover:ring-2 hover:ring-brand-yellow/20 min-h-[44px]"
                  >
                    Anuluj
                  </button>
                  <button
                    type="button"
                    onClick={submit}
                    className="w-full bg-brand-yellow text-gray-900 font-extrabold rounded-xl px-4 py-3 hover:ring-2 hover:ring-brand-yellow/40 min-h-[44px]"
                  >
                    Odblokuj
                  </button>
                </div>
              </div>
            </div>
          )}
        </>
      );
    };

    const MaintenanceOverlay = ({ enabled }) => {
      const [email, setEmail] = useState("");
      const [status, setStatus] = useState({ type: "idle", msg: "" });

      if (!enabled) return null;

      const validEmail = (v) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((v || "").trim());

      const submit = async (e) => {
        e.preventDefault();
        const value = (email || "").trim();

        if (!validEmail(value)) {
          setStatus({ type: "error", msg: "Podaj poprawny adres e-mail." });
          return;
        }

        setStatus({ type: "loading", msg: "Zapisywanie..." });

        try {
          const payload = { content: `ðŸ“© Newsletter signup: **${value}**` };

          const r = await fetch(DISCORD_WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!r.ok) {
            setStatus({ type: "error", msg: `Nie udaÅ‚o siÄ™ zapisaÄ‡ (status ${r.status}).` });
            return;
          }

          setEmail("");
          setStatus({ type: "ok", msg: "DziÄ™ki! DaliÅ›my znaÄ‡ â€” odezwiemy siÄ™ niebawem." });
        } catch (err) {
          console.log("NEWSLETTER ERROR:", err);
          setStatus({ type: "error", msg: "BÅ‚Ä…d poÅ‚Ä…czenia (sprawdÅº konsolÄ™ / CORS)." });
        }
      };

      return (
        <div className="fixed inset-0 z-[110] flex items-center justify-center px-4">
          <div className="absolute inset-0 bg-white/35 backdrop-blur-xl"></div>

          <div className="relative w-full max-w-lg rounded-3xl bg-white/85 border border-white/60 shadow-glass p-6 md:p-8">
            <div className="inline-flex items-center gap-2 text-[10px] font-extrabold tracking-widest uppercase px-3 py-1.5 rounded-full bg-brand-yellow text-gray-900 shadow-sm">
              <span>ðŸš§</span> strona w budowie
            </div>

            <h2 className="text-2xl md:text-3xl font-extrabold mt-4 leading-tight">
              Pracujemy nad nowÄ… wersjÄ… eatmi.pl
            </h2>
            <p className="text-gray-700 mt-3">
              Strona jest w budowie â€” wszelkie informacje podamy niebawem.
            </p>

            <div className="mt-6 bg-white rounded-2xl border border-gray-200 p-4">
              <div className="text-xs uppercase tracking-widest text-gray-500 font-semibold">Newsletter</div>
              <div className="text-sm text-gray-700 mt-1">
                Zostaw e-mail, a damy znaÄ‡, gdy wystartujemy.
              </div>

              <form onSubmit={submit} className="mt-4 flex flex-col sm:flex-row gap-3">
                <input
                  className="input-focus flex-1 border border-gray-200 rounded-xl px-4 py-3 bg-white min-h-[44px]"
                  placeholder="TwÃ³j e-mail"
                  type="email"
                  value={email}
                  onChange={(e) => { setEmail(e.target.value); if (status.type !== "idle") setStatus({ type: "idle", msg: "" }); }}
                  required
                />
                <button
                  type="submit"
                  disabled={status.type === "loading"}
                  className="bg-brand-yellow text-gray-900 font-extrabold rounded-xl px-5 py-3 hover:ring-2 hover:ring-brand-yellow/40 disabled:opacity-60 disabled:cursor-not-allowed min-h-[44px]"
                >
                  Zapisz siÄ™
                </button>
              </form>

              {status.type !== "idle" && (
                <div className={`mt-3 text-sm font-semibold ${
                  status.type === "ok" ? "text-emerald-700" :
                  status.type === "error" ? "text-red-600" :
                  "text-gray-600"
                }`}>
                  {status.msg}
                </div>
              )}
            </div>

            <div className="mt-5 text-xs text-gray-500">
              TwÃ³j adres email zostanie przetworzony oraz wykorzystany do poinformowania ciÄ™ o starcie naszej platformy w formie reklamy lub wiadomoÅ›ci tekstowej.
            </div>
          </div>
        </div>
      );
    };

    /* =======================
       PWA: SERVICE WORKER REGISTER
    ======================= */

    const registerSW = async () => {
      if (!("serviceWorker" in navigator)) return;
      try {
        const reg = await navigator.serviceWorker.register("/sw.js", { scope: "/" });
        reg.addEventListener("updatefound", () => {
          const sw = reg.installing;
          if (!sw) return;
          sw.addEventListener("statechange", () => {
            if (sw.state === "installed" && navigator.serviceWorker.controller) {
              console.log("SW updated. Refresh page to get latest version.");
            }
          });
        });
      } catch (e) {
        console.log("SW register failed:", e);
      }
    };

    /* =======================
       APP
    ======================= */

    const App = () => {
      const [authOpen, setAuthOpen] = useState(false);
      const [orderOpen, setOrderOpen] = useState(false);

      const [maintenance, setMaintenance] = useState(true);

      const [route, setRoute] = useState(window.location.hash || "#/");
      const isMobile = useIsMobile(768);

      useEffect(() => {
        const onHash = () => setRoute(window.location.hash || "#/");
        window.addEventListener("hashchange", onHash);
        return () => window.removeEventListener("hashchange", onHash);
      }, []);

      const { count } = useCart();

      useEffect(() => { window.lucide?.createIcons?.(); }, [authOpen, maintenance, orderOpen, route, count]);

      useEffect(() => { registerSW(); }, []);

      // CTA tylko na telefonie
      const showCTA =
        isMobile &&
        !maintenance &&
        count > 0 &&
        route !== "#/koszyk" &&
        route !== "#/zamowienie";

      return (
        <div className="min-h-screen no-overscroll">
          <div className={maintenance ? "page-blur pointer-events-none select-none" : ""}>
            <Header onOpenAuth={() => setAuthOpen(true)} />

            <main className={`app-content-pad ${showCTA ? "has-cta" : ""}`}>
              <Router />
              <footer className="py-14 text-center text-sm text-gray-500">
                Â© {new Date().getFullYear()} eatmi.pl â€¢ Wszystkie prawa zastrzeÅ¼one
              </footer>
            </main>

            <AuthModal open={authOpen} onClose={() => setAuthOpen(false)} />
          </div>

          <MaintenanceOverlay enabled={maintenance} />

          {!maintenance && (
            <CategorySheet open={orderOpen} onClose={() => setOrderOpen(false)} />
          )}

          <FloatingCheckoutCTA visible={showCTA} />

          <BottomTabBar
            route={route}
            onOpenOrder={() => setOrderOpen(true)}
            onOpenAuth={() => setAuthOpen(true)}
          />

          <DeveloperUnlock onUnlock={() => setMaintenance(false)} />
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(
      <ToastProvider>
        <CartProvider>
          <App />
        </CartProvider>
      </ToastProvider>
    );
  </script>
</body>
</html>
